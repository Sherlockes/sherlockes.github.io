<header class="header">
	<div class="container">
		<div class="logo">
			<a class="logo__link" href="/" title="Sherblog" rel="home">
				<div class="logo__title">Sherblog</div>
				<div class="logo__tagline">Sólo mi forma de hacer las cosas...</div>
			</a>
		</div>
		
<nav class="menu">
	<button class="menu__btn" aria-haspopup="true" aria-expanded="false" tabindex="0">
		<span class="menu__btn-title" tabindex="-1">Menú</span>
	</button>
	<ul class="menu__list">
		<li class="menu__item">
			<a class="menu__link" href="/post/raspberry/">Raspberry Pi</a>
		</li>
		<li class="menu__item">
			<a class="menu__link" href="/post/tasker/">Tasker</a>
		</li>
	</ul>
</nav>

	</div>
</header>

<main class="main content">
	<article class="post">
		<header class="post__header">
			<h1 class="post__title">Publicar desde iaWriter</h1><div class="post__meta meta"></div>
		</header>
		<figure class="post__thumbnail">
			<img src="/images/20180904_hugo_publicar_editor_texto_00.jpg" alt="Publicar desde iaWriter">
		</figure><div class="post__content clearfix">
			

<h3 id="publicar-solo-con-el-editor-de-texto">Publicar solo con el editor de texto</h3>

<p>Hace un tiempo que estoy intentando escribir en Markdown y para WordPress he estado utilizando el Plugin <a href="https://wordpress.org/plugins/wp-markdown/">Wp-MarkDown</a> que me ha permitido realizar la maquetación del post directamente en Markdown. Una vez que he dejado atrás WordPress en favor de Hugo uno de mis objetivos de los últimos meses ha sido poder publicar en el blog simplemente usando un editor de texto.</p>

<p>Pues bien, no sin algo de esfuerzo, al final lo he conseguido. Gracias a Hugo cómo CMS este post que ahora estoy escribiendo lo puedo publicar en mi blog de una forma rápida y sencilla en Markdown directamente desde la aplicación <a href="https://ia.net/writer">iaWritter</a>.</p>

<p>Las etapas del proceso son las siguientes.</p>

<ul>
<li>Parto de un archivo de texto con extensión *.md que renombro con la estructura &ldquo;fecha_nombre_archivo.md&rdquo;.</li>
<li>Escribo el contenido del Post</li>
</ul>

<p>Hasta aquí todo el proceso que he de realizar de forma manual. El resto se realiza de forma automática según la siguiente secuencia.</p>

<ul>
<li><p>Iawriter guarda el archivo de texto en mi unidad de Google Drive en una carpeta específica para los post de la web.</p></li>

<li><p>Gracias a rclone la Raspberry es capaz de sincronizar tanto la carpeta &ldquo;content&rdquo; como la &ldquo;static&rdquo; con la nube de Google Drive mediante un proceso en crontab que se ejecuta cada hora</p></li>
</ul>

<blockquote>
<p>Para crear el proceso que se ejecute cada hora  se utiliza el comando <code>crontab -e</code> añadiendo al final la línea &ldquo;0 * * * * /home/pi/sherblog/publicar.sh&rdquo; donde &ldquo;publicar.sh&rdquo; es el script ejecutable que realiza todas las operaciones.</p>
</blockquote>

<ul>
<li>La misma secuencia de comandos busca en la carpeta &ldquo;post&rdquo; algún archivo sin cabecera para incluirle una genérica que luego será fácil de editar.</li>
</ul>

<blockquote>
<p>Antes de colocar la cabecera, el script comprueba que el archivo no se ha modificado en la última hora para de esta forma &ldquo;garantizar&rdquo; que no se está trabajando en el y no crear problemas de sincronización.</p>
</blockquote>

<ul>
<li><p>Con los cambios efectuados en los archivos sin cabecera se realiza la sincronización inversa hacia la nube de Google.</p></li>

<li><p>Tras sincronizar la carpeta, el script construye toda la web estática a partir de los post y archivos de configuración.</p></li>
</ul>

<blockquote>
<p>Resulta interesante conocer que para hacer referencia al comando &ldquo;hugo&rdquo; hay que usar en el script la ruta completa que en mi caso quedará &ldquo;/usr/local/bin/hugo&rdquo;.</p>
</blockquote>

<ul>
<li><p>Con la web regenerada se suben los cambios a mi cuenta de github donde tengo publicada la web de forma completamente gratuita.</p>

<pre><code class="language-bash">#!/bin/sh
# -*- ENCODING: UTF-8 -*-

#Sincroniza el contenido de la nube de Google Drive con las carpetas locales
rclone sync -v GoogleDrive:/Sherblog/content/ /home/pi/sherblog/content/
rclone sync -v GoogleDrive:/Sherblog/static/ /home/pi/sherblog/static/

#Cambio al directorio de contenidos
cd ~/sherblog/content/post

#Busca archivos sin cabecera para añadirle una genérica
grep -r -L &quot;\-\-\-&quot; * |
while read fname
do
#Minutos que han de pasar desde la ultima modificación para encabezado
minmin=30

#Calculo de los minutos pasados desde la ultima modificacion
umodsg=$(date +%s -r &quot;$fname&quot;)
ahorasg=$(date +%s)
minpasados=$(((ahorasg - umodsg)/60))
echo Han pasado $minpasados de los $minmin minutos desde la modificación de &quot;$fname&quot;

#Inserta la cabecera si han pasado más de 65 minutos
if [ $minpasados -gt $minmin ]; then
echo Colocando la cabecera a &quot;$fname&quot;
cat cabecera.md &quot;$fname&quot; &gt; temp &amp;&amp; mv temp &quot;$fname&quot;
fi
done

#Sincroniza los archivos de la nube con los modificados en local
rclone sync -v /home/pi/sherblog/content/ GoogleDrive:/Sherblog/content/

#Genera la web estática en Hugo
cd ~/sherblog
/usr/local/bin/hugo

#Sube los cambios generados en la web a GitHub
cd ~/sherblog/git/sherlockes.github.io
git add --all
git commit -m &quot;Update&quot;
git push -u origin master

exit 0
</code></pre></li>
</ul>

<p>Y ya está. La web actualizada sin usar nada más que iawriter. Ahora resta idear un método sencillo para subir las imágenes, quizás IFTTT sea una buena opción, pero esto para otro día&hellip;</p>

<blockquote>
<p>A fecha de hoy (Octubre de 2010) el sistema funciona a las mil maravillas en Android pero IAWriter en IOS da algún problema a la hora de guardar los archivos en Google Drive, espero se solvente con alguna actualización.</p>
</blockquote>

			No me apetece perder nada de tiempo con el <a href="https://rgpd.es">RGPD</a> así que si tienes alguna duda, pregunta o sugerencia no dudes en dejarme un <a href="https://twitter.com/sherblogpro">Tweet</a> en @sherblogpro.  Intentaré responderte o complacerte si se o puedo o inventigar en ello para un nuevo post si no lo conozco.
		</div>
		
<div class="post__tags tags clearfix">
	<svg class="tags__badge icon icon-tag" width="16" height="16" viewBox="0 0 32 32"><path d="M32 19c0 1-1 2-1 2L21 31s-1 1-2 1-2-1-2-1L2 16c-1-1-1.4-2-1.4-2S0 12.5 0 11V3C0 1.5.8.8.8.8S1.5 0 3 0h8c1.5 0 3 .6 3 .6S15 1 16 2l15 15s1 1 1 2zM7 10a3 3 0 1 0 0-6 3 3 0 0 0 0 6z"/></svg>
	<ul class="tags__list">
		<li class="tags__item"><a class="tags__link btn" href="/tags/iawriter/" rel="tag">iAWriter</a></li>
	</ul>
</div>
	</article>
	
	
<nav class="post-nav flex">
	<div class="post-nav__item post-nav__item--prev">
		<a class="post-nav__link" href="/apurada-de-frenada/" rel="prev"><span class="post-nav__caption">«&thinsp;Anterior</span><p class="post-nav__post-title">Apurada de frenada</p></a>
	</div>
	<div class="post-nav__item post-nav__item--next">
		<a class="post-nav__link" href="/historia-del-alojamiento-del-blog/" rel="next"><span class="post-nav__caption">Siguiente&thinsp;»</span><p class="post-nav__post-title">Historia del alojamiento del blog</p></a>
	</div>
</nav>
	
</main>


<footer class="footer">
	<div class="container footer__container flex">
		
		<div class="footer__copyright">
			&copy; 2019 Sherblog.
			<span class="footer__copyright-credits">Generado con <a href="https://gohugo.io/" rel="nofollow noopener" target="_blank">Hugo</a> y <a href="https://github.com/Vimux/Mainroad/" rel="nofollow noopener" target="_blank">Mainroad</a>.</span>
		</div>
	</div>
</footer>
