<header class="header">
	<div class="container">
		<div class="logo">
			<a class="logo__link" href="/" title="Sherblog" rel="home">
				<div class="logo__title">Sherblog</div>
				<div class="logo__tagline">Sólo mi forma de hacer las cosas...</div>
			</a>
		</div>
		<div class="divider"></div>
	</div>
</header>

<main class="main content">
	<article class="post">
		<header class="post__header">
			<h1 class="post__title">Raspberry configurando rclone sin entorno gráfico</h1><div class="post__meta meta">
<div class="meta__item-datetime meta__item">
	<svg class="meta__icon icon icon-time" width="16" height="14" viewBox="0 0 30 28"><path d="M15 0C7 0 1 6 1 14s6 14 14 14 14-6 14-14S23 0 15 0zm0 25C9 25 4 20 4 14S9 3 15 3s11 5 11 11-5 11-11 11zm1-18h-2v8.4l6.8 4.4L22 18l-6-3.8V7z"/></svg>
	<time class="meta__text" datetime="2019-07-11T00:00:00">2019-07-11</time>
</div>

<div class="meta__item-categories meta__item">
	<svg class="meta__icon icon icon-category" width="16" height="16" viewBox="0 0 16 16"><path d="m7 2l1 2h8v11h-16v-13z"/></svg>
	<span class="meta__text"><a class="meta__link" href="/categories/raspberry" rel="category">Raspberry</a></span>
</div>
</div>
		</header>
		<figure class="post__thumbnail">
			<img src="/images/20180910_raspberry_rclone_00.jpg" alt="Raspberry configurando rclone sin entorno gráfico">
		</figure>
<div class="post__toc toc">
	<div class="toc__title">Índice</div>
	<div class="toc__menu">
		<nav id="TableOfContents">
<ul>
<li><a href="#instalación">Instalación</a></li>
<li><a href="#configuración-de-la-nube">Configuración de la nube</a></li>
<li><a href="#encriptación-de-la-nube">Encriptación de la nube</a></li>
</ul>
</nav>
	</div>
</div>
<div class="post__content clearfix">
			<p>En linux no hay cliente oficial para acceder a Google Drive pero por suerte hay varias utilizades que permiten realizar enta labor.  Hay cientos de post al respecto de la existencia de estas utilidades, por lo que no voy a crear uno más, simplemente voy a explicar mi experiencia con una de las que yo utilizo. <a href="https://rclone.org">Rclone</a></p>

<h1 id="instalación">Instalación</h1>

<p>La instalación es realmente sencilla gracias al script que hay en la web oficial</p>

<pre><code class="language-bash">curl https://rclone.org/install.sh | sudo bash
</code></pre>

<p>Podemos comprobar que se ha instalado correctemente mediante el comando</p>

<pre><code class="language-bash">rclone -V
</code></pre>

<h1 id="configuración-de-la-nube">Configuración de la nube</h1>

<p>Hasta aquí bastante sencillo, el problema viene en el momento que intentamos configurar cualquiera de las nubes ya que, a priori, es necessario un entorno gráfico para conseguir el código de autorización a través del navegador web.</p>

<blockquote>
<p>Por la red circulan varios tutoriales para realizar esta configuración de las nubes mediante navegadores web en línea de comando en modo texto y&hellip; después de probar varios no he conseguido que me funcione ninguno para esta operación.  A unos del falla el javascript&hellip;</p>
</blockquote>

<p>En ausencia de entorno gráfico en  la Raspberry voy a utilizar el viejo portatil con linux Mint desde el que accedo a la misma para realizar esta configuración.</p>

<p>Empezamos a añadir una nueva nube mediante</p>

<pre><code class="language-bash">rclone config
</code></pre>

<p>y nos aparecen las suigiente opciones</p>

<pre><code class="language-bash">No remotes found - make a new one
n) New remote
s) Set configuration password
q) Quit config
n/s/q&gt;
</code></pre>

<p>Optamos por &ldquo;n&rdquo; para añadir una nueva nube remota.  En mi caso voy a realizar una sincroización con Google Drive por lo que cuando se me solicita el nombre utilizo &ldquo;gdrive&rdquo; y ante la opción &ldquo;storage&rdquo; selecciono el 11 que es el correspondiente a Google Drive.</p>

<pre><code>Type of storage to configure.
Enter a string value. Press Enter for the default (&quot;&quot;).
Choose a number from below, or type in your own value
 1 / Alias for a existing remote
   \ &quot;alias&quot;
 2 / Amazon Drive
   \ &quot;amazon cloud drive&quot;
 3 / Amazon S3 Compliant Storage Providers (AWS, Ceph, Dreamhost, IBM COS, Minio)
   \ &quot;s3&quot;
 4 / Backblaze B2
   \ &quot;b2&quot;
 5 / Box
   \ &quot;box&quot;
 6 / Cache a remote
   \ &quot;cache&quot;
 7 / Dropbox
   \ &quot;dropbox&quot;
 8 / Encrypt/Decrypt a remote
   \ &quot;crypt&quot;
 9 / FTP Connection
   \ &quot;ftp&quot;
10 / Google Cloud Storage (this is not Google Drive)
   \ &quot;google cloud storage&quot;
11 / Google Drive
   \ &quot;drive&quot;
12 / Hubic
   \ &quot;hubic&quot;
13 / JottaCloud
   \ &quot;jottacloud&quot;
14 / Local Disk
   \ &quot;local&quot;
15 / Mega
   \ &quot;mega&quot;
16 / Microsoft Azure Blob Storage
   \ &quot;azureblob&quot;
17 / Microsoft OneDrive
   \ &quot;onedrive&quot;
18 / OpenDrive
   \ &quot;opendrive&quot;
19 / Openstack Swift (Rackspace Cloud Files, Memset Memstore, OVH)
   \ &quot;swift&quot;
20 / Pcloud
   \ &quot;pcloud&quot;
21 / QingCloud Object Storage
   \ &quot;qingstor&quot;
22 / SSH/SFTP Connection
   \ &quot;sftp&quot;
23 / Webdav
   \ &quot;webdav&quot;
24 / Yandex Disk
   \ &quot;yandex&quot;
25 / http Connection
   \ &quot;http&quot;
Storage&gt; 
</code></pre>

<p>A continuación, las opciones &ldquo;client_id&rdquo; y &ldquo;client_secret&rdquo; las dejo en blanco.  La siguiente opción es el tipo de acceso que voy a necesitar, sólo lectura, lectura y escritura&hellip;</p>

<pre><code class="language-bash"> 1 / Full access all files, excluding Application Data Folder.
   \ &quot;drive&quot;
 2 / Read-only access to file metadata and file contents.
   \ &quot;drive.readonly&quot;
   / Access to files created by rclone only.
 3 | These are visible in the drive website.
   | File authorization is revoked when the user deauthorizes the app.
   \ &quot;drive.file&quot;
   / Allows read and write access to the Application Data folder.
 4 | This is not visible in the drive website.
   \ &quot;drive.appfolder&quot;
   / Allows read-only access to file metadata but
 5 | does not allow any access to read or download file content.
   \ &quot;drive.metadata.readonly&quot;

</code></pre>

<p>Selecciono &ldquo;1&rdquo; puesto que quiero tanto poder leer como escribir en las carpetas de la nube.</p>

<p>Ahora, la opcion &ldquo;ID of the root folder&rdquo; la dejo en blanco para poder acceder a toda la nube.  Deja tambien en blanco la opción &ldquo;Service Account Credentials JSON file path&rdquo;</p>

<p>La siguiente opción es la configuración avanzada que no necesitamos.</p>

<pre><code class="language-bash">Edit advanced config? (y/n)
y) Yes
n) No
y/n&gt; n
</code></pre>

<p>Y ahora llega lo más interesante del post.  Cuando se nos pregunta por la configuración automática debemos seleccionar la opción &ldquo;No&rdquo;</p>

<p>Ya ha llegado el momento de la arte más interesante de este post para la que abriremos una nueva sesion de terminal pero en este caso directamente en la instalación de Linux Mint que tengo instalada en el portatil.  Hay que tener instalado Rclone tambien en esta máquina con navegador completo y entorno gráfico.  Si no lo tengo, lo instalo y a continuación ejecuto el siguiente comando.</p>

<pre><code class="language-bash">rclone authorize &quot;drive&quot;
</code></pre>

<blockquote>
<p>He usado la opción &ldquo;drive&rdquo; por estar configurando una cuenta de Google Drive, para el resto de servicios hay que revisar la lista en la que anteriormente hemos seleccionado el tipo de nube para ver la opción que debemos poner entrecomillada.</p>
</blockquote>

<p>Si todo ha ido bien se nos abrirá el navegador en Linux Mint y nos pedirá la cuente de Google Drive a la que queremos dar permiso tal y como se muestra en la siguiente imagen.</p>

<p><img src="/images/20180910_raspberry_rclone_01.jpg" alt="imagen" /></p>

<p>Tras permitir el acceso a Rclone a nuestra nube de google drive, si todo ha ido bien  nos aparece una ventana tan simple como expresiva&hellip;</p>

<p><img src="/images/20180910_raspberry_rclone_02.jpg" alt="imagen" /></p>

<p>Y ya podemos cerrar el navegador para volver a la sesión de terminal sobre Linux Mint en la que aparecerá algo así</p>

<pre><code>Log in and authorize rclone for access
Waiting for code...
Got code
Paste the following into your remote machine ---&gt;
{&quot;access_token&quot;:&quot;ya29.GlsUErbFcat-9A3rWwjFXtLPnZyHTuaRiNMp9-Dshye44tciu3Ad1syvXrtCqXau_3N8gYt7d4bRzDsTlRVeF79Qcf8Id-IBvwW_wr88s-PELgRs9KKaf&quot;,&quot;token_type&quot;:&quot;Bearer&quot;,&quot;refresh_token&quot;:&quot;1/90zRjxj0d7fDh-W979DbnJ6xscxcsKto0ekygRo-97yOns&quot;,&quot;expiry&quot;:&quot;2018-09-10T18:22:45.52936872+02:00&quot;}
&lt;---End pasteConfigure this as a team drive?
y) Yes
n) No
y/n&gt;
</code></pre>

<p>Y&hellip; después de todo este trabajo y de intentar documentar sobre la marcha el <a href="https://rclone.org/remote_setup/">método oficial </a> que debería funcionar resulta que me aparece un error por faltar el parámetro &ldquo;Code&rdquo;</p>

<pre><code class="language-bash">Failed to configure token: failed to get token: oauth2: cannot fetch token: 400 Bad Request
Response: {
  &quot;error&quot; : &quot;invalid_grant&quot;,
  &quot;error_description&quot; : &quot;Malformed auth code.&quot;
}
</code></pre>

<p>Toca probar el plan&rdquo;b&rdquo; que consiste en configurar la nube desde la instalación de Linux Mint y posterior mente copiar el archivo de configuración a la Raspberry. Con todo lo explicado anteriormente no creo que sea necesario más para configurar Google Drive en Rclone instalado sobre Linux Mint, sólo restaba en la últime opción escoger la opción &ldquo;Si&rdquo; en la configuración automática y se nos abre el navegador para permitir el acceso.</p>

<p>Con la nube configurada en Linux Mint hay que buscar el archivo de configuración de rclone que en mi caso se encuentra en &ldquo;/home/sherlockes/.config/rclone/rclone.conf&rdquo; para el caso de la instalación sobre el portatil  y en &ldquo;/home/pi/.config/rclone/rclone.conf&rdquo; para el caso de la Raspberry.</p>

<p>Es posible copiar directamente el archivo de una máquina a otra a través de ssh mediante el comando scp</p>

<pre><code class="language-bash">scp /home/sherlockes/.config/rclone/rclone.conf pi@192.168.1.203:/home/pi/.config/rclone/
</code></pre>

<p>Y con esto ya debería estar configurada la nube de Google Drive en la instalación de rclone de la raspberry, la mejor muestra es que al introcudir el comando &ldquo;rclone config&rdquo; en una sesión de la terminal sobre la Raspberry nos aparecerá algo como lo siguiente.</p>

<pre><code class="language-bash">Current remotes:

Name                 Type
====                 ====
GoogleDrive          drive

e) Edit existing remote
n) New remote
d) Delete remote
r) Rename remote
c) Copy remote
s) Set configuration password
q) Quit config
e/n/d/r/c/s/q&gt; 
</code></pre>

<p>En la que podremos ver la que ya tenemos una nube añadida.</p>

<h1 id="encriptación-de-la-nube">Encriptación de la nube</h1>

<p>Es recomendable empezar con una carpeta vacía en la nube en la que queremos subir el contenido encriptado. Para, previamente tal y como he explicado hay que configurar la nube en rclone y luego pasamos a configurar la carpeta encriptada &ldquo;micarpeta&rdquo;.</p>

<p>1- Accedemos a la configuración de Rclone <code>rclone config</code>
1- Creamos un nuevo remoto <kbd>n</kbd>
2- Nombramos la carpeta <code>micarpeta</code></p>

<p>Para otro día el modo de realizar la sincronización o copia de contenidos desde la nube hasa la Raspberry.</p>
			No me apetece perder nada de tiempo con el <a href="https://rgpd.es">RGPD</a> así que si tienes alguna duda, pregunta o sugerencia no dudes en dejarme un <a href="https://twitter.com/sherblogpro">Tweet</a> en @sherblogpro.  Intentaré responderte o complacerte si se o puedo o inventigar en ello para un nuevo post si no lo conozco.
		</div>
		
<div class="post__tags tags clearfix">
	<svg class="tags__badge icon icon-tag" width="16" height="16" viewBox="0 0 32 32"><path d="M32 19c0 1-1 2-1 2L21 31s-1 1-2 1-2-1-2-1L2 16c-1-1-1.4-2-1.4-2S0 12.5 0 11V3C0 1.5.8.8.8.8S1.5 0 3 0h8c1.5 0 3 .6 3 .6S15 1 16 2l15 15s1 1 1 2zM7 10a3 3 0 1 0 0-6 3 3 0 0 0 0 6z"/></svg>
	<ul class="tags__list">
		<li class="tags__item"><a class="tags__link btn" href="/tags/desarrollo/" rel="tag">Desarrollo</a></li>
		<li class="tags__item"><a class="tags__link btn" href="/tags/rclone/" rel="tag">Rclone</a></li>
	</ul>
</div>
	</article>
	
	
<nav class="post-nav flex">
	<div class="post-nav__item post-nav__item--prev">
		<a class="post-nav__link" href="/raspberry-montaje-y-ssh/" rel="prev"><span class="post-nav__caption">«&thinsp;Anterior</span><p class="post-nav__post-title">Raspberry Montaje y ssh</p></a>
	</div>
</nav>
	
</main>


<footer class="footer">
	<div class="container footer__container flex">
		
		<div class="footer__copyright">
			&copy; 2019 Sherblog.
			<span class="footer__copyright-credits">Generado con <a href="https://gohugo.io/" rel="nofollow noopener" target="_blank">Hugo</a> y <a href="https://github.com/Vimux/Mainroad/" rel="nofollow noopener" target="_blank">Mainroad</a>.</span>
		</div>
	</div>
</footer>
