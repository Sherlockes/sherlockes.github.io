<!DOCTYPE html>
<html lang="es">
<head>
	<meta charset="UTF-8">
	<meta name="viewport" content="width=device-width, initial-scale=1">
	<meta http-equiv="X-UA-Compatible" content="IE=edge">
	<title>Copia de seguridad de la base de datos de WordPress</title>
	<meta name="description" content="Así es como realizo la copia de seguridad de la base de datos de WordPress hacia Google Drive">

	<meta name="twitter:card" content="Así es como realizo la copia de seguridad de la base de datos de WordPress hacia Google Drive" />
	<meta name="twitter:title" content="Copia de seguridad de la base de datos de WordPress" />
	<meta name="twitter:image" content="http://sherblog.pro/images/20170228_db_backup_00.jpg" />
	
	<meta name="twitter:creator" content="@sherblogpro">
	<meta name="twitter:site" content="sherblog.pro" />
	<meta name="twitter:description" content="Aquí puedes ver todo el post." />

	<meta name="generator" content="Hugo 0.42.1" />
	<meta property="og:title" content="Copia de seguridad de la base de datos de WordPress" />
<meta property="og:description" content="Así es como realizo la copia de seguridad de la base de datos de WordPress hacia Google Drive" />
<meta property="og:type" content="article" />
<meta property="og:url" content="/copia-de-seguridad-de-la-base-de-datos-de-wordpress/" />



<meta property="article:published_time" content="2017-04-04T00:00:00&#43;00:00"/>

<meta property="article:modified_time" content="2017-04-04T00:00:00&#43;00:00"/>











	<meta name="twitter:card" content="summary"/>
<meta name="twitter:title" content="Copia de seguridad de la base de datos de WordPress"/>
<meta name="twitter:description" content="Así es como realizo la copia de seguridad de la base de datos de WordPress hacia Google Drive"/>

	<link rel="dns-prefetch" href="//fonts.googleapis.com">
	<link rel="dns-prefetch" href="//fonts.gstatic.com">
	<link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Open+Sans:400,400i,700">
	<link rel="stylesheet" href="/css/style.css">
	<script type="text/javascript" src="/js/scripts.js"></script>
	<link rel="shortcut icon" href="http://sherblog.pro/favicon.ico">
	
</head>
<body class="body body-right-sidebar">
	<div class="container container-outer">
		<header class="header">
			<div class="container container-inner">
				<div class="logo" role="banner">
					<a class="logo__link" href="/" title="Sherblog" rel="home">
						<div class="logo__title">Sherblog</div>
						<div class="logo__tagline">Sólo mi forma de hacer las cosas...</div>
					</a>
				</div>
			</div>
			
<nav class="menu">
	<ul class="menu__list">
		<li class="menu__item"><a class="menu__link" href="/post/raspberry/">RASPBERRY PI</a></li>
		<li class="menu__item"><a class="menu__link" href="/post/tasker/">TASKER</a></li>
	</ul>
</nav>

		</header>
		<div class="wrapper clearfix">


<main class="main content">
	<article class="post">
		<header class="post__header">
			<h1 class="post__title">Copia de seguridad de la base de datos de WordPress</h1><div class="post__meta meta">
<svg class="icon icon-time" width="16" height="14" viewBox="0 0 16 16"><path d="m8-.0000003c-4.4 0-8 3.6-8 8 0 4.4000003 3.6 8.0000003 8 8.0000003 4.4 0 8-3.6 8-8.0000003 0-4.4-3.6-8-8-8zm0 14.4000003c-3.52 0-6.4-2.88-6.4-6.4000003 0-3.52 2.88-6.4 6.4-6.4 3.52 0 6.4 2.88 6.4 6.4 0 3.5200003-2.88 6.4000003-6.4 6.4000003zm.4-10.4000003h-1.2v4.8l4.16 2.5600003.64-1.04-3.6-2.1600003z"/></svg>
<time class="post__meta-date meta-date" datetime="2017-04-04T00:00:00">April 04, 2017</time>
<span class="post__meta-categories meta-categories">
	<svg class="icon icon-category" width="16" height="16" viewBox="0 0 16 16"><path d="m7 2l1 2h8v11h-16v-13z"/></svg>
	<span class="meta-categories__list"><a class="meta-categories__link" href="/categories/wordpress" rel="category">Wordpress</a>, <a class="meta-categories__link" href="/categories/sherver" rel="category">Sherver</a></span>
</span></div>
		</header>
		<figure class="post__thumbnail">
			<img src="/images/20170228_db_backup_00.jpg" alt="Copia de seguridad de la base de datos de WordPress">
		</figure><div class="post__content clearfix">
			<p>Hace unos días expliqué como gestiona la copia de seguridad de los archivos de WordPress (la carpeta wp-content) y aquí vamos a ver como hago lo propio con la base de datos. El flujo de trabajo es simple, periódicamente me llega un correo electrónico con la base de datos comprimida como archivo adjunto y guardo ese archivo en mi unidad de Google Drive.</p>

<p>El plugin de WordPress <a href=" https://es.wordpress.org/plugins/wp-db-backup/">WP-DB-Backup</a> es el que se encarga de enviar un correo electrónico periódicamente con la copia de la base de datos. La configuración es muy sencilla, una vez que el plugin está instalado y activo vamos al menú &ldquo;Herramientas - Copia de respaldo&rdquo; del escritorio de WordPress y bajamos hasta la opción &ldquo;Respaldo Programado&rdquo;.</p>

<p><img src="/images/20170228_db_backup_01.jpg" alt="image" /></p>

<p>Seleccionamos la frecuencia del respaldo y las tablas adicionales a respaldar, introducimos la dirección de correo a la que vamos a enviar el respaldo y pulsamos el botón &ldquo;Respaldo Programado&rdquo; para guardar la configuración.</p>

<p>A continuación vamos a crear un programa dentro de Google Apps Script que nos guardará el archivo adjunto en una carpeta de nuestra unidad de Google Drive y borrará el correo electrónico.</p>

<pre><code>// Declaración de variables
var ahora = new Date();
var correos = GmailApp.search(&quot;subject:(*SherBlog Copia de seguridad de la base de datos*) has:attachment&quot;);
var carpeta = DriveApp.searchFolders(&quot;title contains 'sherblog_db_backups'&quot;).next();
var archivos = new Array();
 
// Matrices para distintos rangos de antiguedad 10-20-40-80-160 
var d10 = new Array();
var d20 = new Array();
var d40 = new Array();
var d80 = new Array();
var d160 = new Array();
 
function backup_db() {
  
  // Guardar los archivos adjuntos y borra los correos
  for (var x=0; x&lt;correos.length; x++) {
    var mensaje = correos[x].getMessages()[0];
    var adjuntos = mensaje.getAttachments();
    carpeta.createFile(adjuntos[0]);
    correos[x].moveToTrash();
  }
                 
  // Genera matriz con los archivos ya existentes en carpeta
  archivos = carpeta.getFiles();
  
  while (archivos.hasNext()) {
    archivo = archivos.next();
    // Asigna cada archivo al rango de antiguedad y borra los obsoletos
    if(dias(archivo)&gt;5 &amp;&amp; dias(archivo)&lt;11){d10.push(archivo)};
    if(dias(archivo)&gt;10 &amp;&amp; dias(archivo)&lt;21){d20.push(archivo)};
    if(dias(archivo)&gt;20 &amp;&amp; dias(archivo)&lt;41){d40.push(archivo)};
    if(dias(archivo)&gt;40 &amp;&amp; dias(archivo)&lt;81){d80.push(archivo)};
    if(dias(archivo)&gt;80 &amp;&amp; dias(archivo)&lt;161){d160.push(archivo)};
    if(dias(archivo)&gt;160){archivo.setTrashed(true)};
  }
               
  // Borrar los archivos recientes de cada rango
  limpiar(d10);
  limpiar(d20);
  limpiar(d40);
  limpiar(d80);
  limpiar(d160); 
}
 
// función para contar los días de antiguedad de un archivo
function dias(archiv){
  return(Math.round((ahora - archiv.getLastUpdated())/1000/60/60/24));
}
 
// Función para eliminar los archivos mas recientes de una matriz
function limpiar(matriz){
  while (matriz.length&gt;1){
    if(dias(matriz[0])&gt;dias(matriz[1])){
      matriz[1].setTrashed(true);  //Elimina el archivo más reciente
      matriz.splice(1,1);  //Elimina la entrada de la matriz correspondiente al archivo borrado
    }else{
      matriz[0].setTrashed(true);
      matriz.splice(0,1);
    }
  }
}
</code></pre>

<p>Con esto ya tenemos guardada en nuestra unidad de Google Drive una copia de seguridad de la base de datos de WordPress de la web.</p>

<p>Para el tema del guardado de versiones he optado por un sistema tan simple como efectivo, tal y como se puede ver en el código se guardan los siguientes archivos.</p>

<ul>
<li>Un archivo por cada uno de los cinco últimos días</li>
<li>Un archivo con una antigüedad entre 5 y 10 días</li>
<li>Un archivo con una antigüedad entre 10 y 20 días</li>
<li>Un archivo con una antigüedad entre 20 y 40 días</li>
<li>Un archivo con una antigüedad entre 40 y 80 días</li>
<li>Un archivo con una antigüedad entre 80 y 160 días</li>
</ul>

<p>Y con esto creo que tengo más que suficiente para cubrir mis necesidades ocupando un espacio limitado.</p>

			No me apetece perder nada de tiempo con el <a href="https://rgpd.es">RGPD</a> así que si tienes alguna duda, pregunta o sugerencia no dudes en dejarme un <a href="https://twitter.com/sherblogpro">Tweet</a> en @sherblogpro.  Intentaré responderte o complacerte si se o puedo o inventigar en ello para un nuevo post si no lo conozco.
		</div>
		
	</article>
	
	
<nav class="post-nav row clearfix">
	<div class="post-nav__item post-nav__item--prev col-1-2">
		<a class="post-nav__link" href="/flujo-de-trabajo-con-im%C3%A1genes-en-wordpress/" rel="prev"><span class="post-nav__caption">«&thinsp;Anterior</span><p class="post-nav__post-title">Flujo de trabajo con imágenes en WordPress</p></a>
	</div>
	<div class="post-nav__item post-nav__item--next col-1-2">
		<a class="post-nav__link" href="/deshabilitar-cache-en-chrome/" rel="next"><span class="post-nav__caption">Siguiente&thinsp;»</span><p class="post-nav__post-title">Deshabilitar cache en chrome</p></a>
	</div>
</nav>
	
</main>

<aside class="sidebar">
	
	
<div class="widget-recent widget">
	<h4 class="widget__title">Lo último...</h4>
	<div class="widget__content">
		<ul class="widget__list">
			<li class="widget__item"><a class="widget__link" href="/raspberry-configurando-rclone-sin-entorno-gr%C3%A1fico/">Raspberry configurando rclone sin entorno gráfico</a></li>
			<li class="widget__item"><a class="widget__link" href="/apurada-de-frenada/">Apurada de frenada</a></li>
			<li class="widget__item"><a class="widget__link" href="/cubierta-ko-decathlon-ok/">Cubierta KO, Decathlon OK</a></li>
			<li class="widget__item"><a class="widget__link" href="/copiar-ssh-key-desde-synology/">Copiar ssh key desde Synology</a></li>
			<li class="widget__item"><a class="widget__link" href="/adios-wordpress/">Adios WordPress</a></li>
		</ul>
	</div>
</div>
	
<div class="widget-categories widget">
	<h4 class="widget__title">Categorias</h4>
	<div class="widget__content">
		<ul class="widget__list">
			<li class="widget__item"><a class="widget__link" href="/categories/a-pedales">A pedales</a></li>
			<li class="widget__item"><a class="widget__link" href="/categories/desarrollo">Desarrollo</a></li>
			<li class="widget__item"><a class="widget__link" href="/categories/gps">Gps</a></li>
			<li class="widget__item"><a class="widget__link" href="/categories/linux">Linux</a></li>
			<li class="widget__item"><a class="widget__link" href="/categories/raspberry">Raspberry</a></li>
			<li class="widget__item"><a class="widget__link" href="/categories/sherver">Sherver</a></li>
			<li class="widget__item"><a class="widget__link" href="/categories/tasker">Tasker</a></li>
			<li class="widget__item"><a class="widget__link" href="/categories/varios">Varios</a></li>
			<li class="widget__item"><a class="widget__link" href="/categories/wordpress">Wordpress</a></li>
		</ul>
	</div>
</div>
	
<div class="widget-social widget">
	<h4 class="widget-social__title widget__title">Mis redes sociales</h4>
	<div class="widget-social__content widget__content">
		<div class="widget-social__item widget__item">
			<a class="widget-social__link widget__link btn" title="Facebook" rel="noopener noreferrer" href="https://facebook.com/sherblog.es" target="_blank">
				<svg class="widget-social__link-icon icon-facebook" viewBox="0 0 352 352" width="24" height="24" fill="#fff"><path d="m0 32v288c0 17.5 14.5 32 32 32h288c17.5 0 32-14.5 32-32v-288c0-17.5-14.5-32-32-32h-288c-17.5 0-32 14.5-32 32zm320 0v288h-83v-108h41.5l6-48h-47.5v-31c0-14 3.5-23.5 23.5-23.5h26v-43.5c-4.4-.6-19.8-1.5-37.5-1.5-36.9 0-62 22.2-62 63.5v36h-42v48h42v108h-155v-288z"/></svg>
				<span>Facebook</span>
			</a>
		</div>
		
		<div class="widget-social__item widget__item">
			<a class="widget-social__link widget__link btn" title="Twitter" rel="noopener noreferrer" href="https://twitter.com/sherblogpro" target="_blank">
				<svg class="widget-social__link-icon icon-twitter" viewBox="0 0 384 312" width="24" height="24" fill="#fff"><path d="m384 36.9c-14.1 6.3-29.3 10.5-45.2 12.4 16.3-9.7 28.8-25.2 34.6-43.6-15.2 9-32.1 15.6-50 19.1-14.4-15.2-34.9-24.8-57.5-24.8-43.5 0-78.8 35.3-78.8 78.8 0 6.2.7 12.2 2 17.9-65.5-3.3-123.5-34.6-162.4-82.3-6.7 11.6-10.6 25.2-10.6 39.6 0 27.3 13.9 51.4 35 65.6-12.9-.4-25.1-4-35.7-9.9v1c0 38.2 27.2 70 63.2 77.2-6.6 1.8-13.6 2.8-20.8 2.8-5.1 0-10-.5-14.8-1.4 10 31.3 39.1 54.1 73.6 54.7-27 21.1-60.9 33.7-97.8 33.7-6.4 0-12.6-.4-18.8-1.1 34.9 22.4 76.3 35.4 120.8 35.4 144.9 0 224.1-120 224.1-224.1 0-3.4-.1-6.8-.2-10.2 15.4-11.1 28.7-25 39.3-40.8z"/></svg>
				<span>Twitter</span>
			</a>
		</div>
		<div class="widget-social__item widget__item">
			<a class="widget-social__link widget__link btn" title="Strava" rel="noopener noreferrer" href="https://www.strava.com/athletes/11156844" target="_blank">
				<svg class="widget-social__link-icon icon-Strava" viewBox="0 0 352 352" width="24" height="24" fill="#fff"><path
     id="path3723"
     d="M 148.68422,219.94575 118.86844,161 l 17.31578,0.005 17.31578,0.005 12.32699,23.9954 C 172.60684,198.20207 178.34254,209 178.57299,209 178.80344,209 184.3956,198.2 191,185 l 12.008,-24 h 16.996 c 9.3478,0 16.97134,0.3375 16.94121,0.75 -0.0301,0.4125 -13.19264,26.93809 -29.25,58.94575 L 178.5,278.89149 Z M 42,159.50168 C 42,158.5198 120.50481,2.0000114 120.99703,2.0005325 121.51325,2.001079 201,158.42106 201,159.43637 201,159.74637 190.53188,160 177.7375,160 H 154.47501 L 138.4875,127.91974 C 129.69438,110.27559 122.17195,95.629873 121.771,95.373696 121.37005,95.117519 113.72327,109.55364 104.77816,127.45396 L 88.514317,160 H 65.257158 C 52.465721,160 42,159.77576 42,159.50168 Z"/></svg>
				<span>Strava</span>
			</a>
		</div>
		</div>
</div>

	
<div class="widget-taglist widget">
	<h4 class="widget__title">Tags</h4>
	<div class="widget__content">
		<a class="widget-taglist__link widget__link btn" href="/tags/averias" title="Averias">Averias</a>
		<a class="widget-taglist__link widget__link btn" href="/tags/bricolaje" title="Bricolaje">Bricolaje</a>
		<a class="widget-taglist__link widget__link btn" href="/tags/desarrollo" title="Desarrollo">Desarrollo</a>
		<a class="widget-taglist__link widget__link btn" href="/tags/fontaner%c3%ada" title="Fontanería">Fontanería</a>
		<a class="widget-taglist__link widget__link btn" href="/tags/google" title="Google">Google</a>
		<a class="widget-taglist__link widget__link btn" href="/tags/gopro" title="Gopro">Gopro</a>
		<a class="widget-taglist__link widget__link btn" href="/tags/gps" title="Gps">Gps</a>
		<a class="widget-taglist__link widget__link btn" href="/tags/keep" title="Keep">Keep</a>
		<a class="widget-taglist__link widget__link btn" href="/tags/mantenimiento" title="Mantenimiento">Mantenimiento</a>
		<a class="widget-taglist__link widget__link btn" href="/tags/mapas" title="Mapas">Mapas</a>
		<a class="widget-taglist__link widget__link btn" href="/tags/podcast" title="Podcast">Podcast</a>
		<a class="widget-taglist__link widget__link btn" href="/tags/rclone" title="Rclone">Rclone</a>
		<a class="widget-taglist__link widget__link btn" href="/tags/synology" title="Synology">Synology</a>
	</div>
</div>
</aside>
	</div>
		<footer class="footer">
			<div class="container container-inner">
				<div class="footer__copyright">&copy; 2018 Sherblog. <span class="footer__copyright-credits">Generado con <a href="https://gohugo.io/" rel="nofollow noopener" target="_blank">Hugo</a> y el tema <a href="https://github.com/Vimux/Mainroad/" rel="nofollow noopener" target="_blank">Mainroad</a> editado por Sherlockes.</span></div>
			</div>
		</footer>
	</div>

<script>
	var navigation = responsiveNav(".menu", {
		navClass: "menu--collapse",
	});
</script></body>
</html>
